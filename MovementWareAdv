local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local UIS = game:GetService("UserInputService")
local lp = Players.LocalPlayer

--Config--
local CORRECT_KEY = "4NZ" -- 在這裡設定你的密碼
local FILE_NAME = "MovementWare_Auth.txt" -- 存檔名稱

-- 這是主程式，驗證通過後會執行這個
local function init()
    -- // 在這裡放入你的主要腳本 (例如 Rayfield) // --
    
    -- 範例：發送一個通知
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Authentication",
        Text = "Welcome back, " .. lp.Name,
        Duration = 5
    })
    
    -- 把你原本的 Rayfield 代碼貼在這裡
    loadstring(game:HttpGet('https://raw.githubusercontent.com/dudubladespot-cyber/4NZ/refs/heads/main/4NZ'))() 
end

-- // 驗證邏輯開始 // --

-- 1. 檢查是否已經存過密碼
local isVerified = false

if isfile and readfile and isfile(FILE_NAME) then
    local savedKey = readfile(FILE_NAME)
    if savedKey == CORRECT_KEY then
        isVerified = true
    end
end

-- 2. 如果已經驗證，直接執行
if isVerified then
    init()
else
    -- 3. 如果沒驗證，建立 GUI
    local authGui = Instance.new("ScreenGui")
    authGui.Name = "AuthScreen"
    -- 嘗試放入 CoreGui 以防止被重置，如果不行則放 PlayerGui
    if pcall(function() authGui.Parent = CoreGui end) then
    else authGui.Parent = lp.PlayerGui end
    authGui.ResetOnSpawn = false

    local main = Instance.new("Frame", authGui)
    main.Size = UDim2.new(0, 350, 0, 200)
    main.Position = UDim2.new(0.5, -175, 0.5, -100)
    main.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    main.BorderSizePixel = 0
    main.Active = true
    main.Draggable = true -- 讓視窗可以拖動

    local uistroke = Instance.new("UIStroke", main)
    uistroke.Color = Color3.fromHex("A475D7") -- 紫色邊框
    uistroke.Thickness = 2
    
    Instance.new("UICorner", main).CornerRadius = UDim.new(0, 8)

    -- 標題
    local title = Instance.new("TextLabel", main)
    title.Size = UDim2.new(1, 0, 0, 40)
    title.BackgroundTransparency = 1
    title.Text = "AUTHENTICATION"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 18

    -- 輸入框
    local input = Instance.new("TextBox", main)
    input.Size = UDim2.new(0, 280, 0, 45)
    input.Position = UDim2.new(0.5, -140, 0.35, 0)
    input.PlaceholderText = "Enter Key..."
    input.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    input.TextColor3 = Color3.fromRGB(255, 255, 255)
    input.Font = Enum.Font.Gotham
    input.TextSize = 14
    
    local inputCorner = Instance.new("UICorner", input)
    inputCorner.CornerRadius = UDim.new(0, 6)

    -- 按鈕
    local btn = Instance.new("TextButton", main)
    btn.Size = UDim2.new(0, 200, 0, 40)
    btn.Position = UDim2.new(0.5, -100, 0.7, 0)
    btn.Text = "VERIFY"
    btn.BackgroundColor3 = Color3.fromHex("A475D7")
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 16
    
    local btnCorner = Instance.new("UICorner", btn)
    btnCorner.CornerRadius = UDim.new(0, 6)

    -- 按鈕點擊事件
    btn.MouseButton1Click:Connect(function()
        if input.Text == CORRECT_KEY then
            -- 密碼正確
            btn.Text = "SUCCESS"
            btn.BackgroundColor3 = Color3.fromRGB(0, 170, 0) -- 變綠色
            wait(0.5)
            
            -- 存檔
            if writefile then
                writefile(FILE_NAME, input.Text)
            end
            
            -- 刪除 GUI 並執行主程式
            authGui:Destroy()
            init()
        else
            -- 密碼錯誤
            btn.Text = "INCORRECT"
            local oldColor = btn.BackgroundColor3
            btn.BackgroundColor3 = Color3.fromRGB(170, 0, 0) -- 變紅色
            wait(1)
            btn.Text = "VERIFY"
            btn.BackgroundColor3 = oldColor
        end
    end)
end
